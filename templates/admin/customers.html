{% extends "admin/base.html" %}

{% block title %}Customers - {{ config.brand_name }} Admin{% endblock %}

{% block page_title %}Customer Management{% endblock %}
{% block page_subtitle %}Manage and view all registered customers{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card-admin bg-stat-1 text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-white-50 mb-1">Total Customers</h6>
                            <h2 class="text-white mb-0">{{ customers|length if customers else 0 }}</h2>
                            <small class="text-white-50">All registered customers</small>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card-admin bg-stat-2 text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-white-50 mb-1">Today's Signups</h6>
                            <h2 class="text-white mb-0">{{ today_customers|default(0) }}</h2>
                            <small class="text-white-50">New customers today</small>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card-admin bg-stat-3 text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-white-50 mb-1">Active This Week</h6>
                            <h2 class="text-white mb-0">{{ active_this_week|default(0) }}</h2>
                            <small class="text-white-50">Customers with orders this week</small>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card-admin bg-stat-4 text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-white-50 mb-1">Average Orders</h6>
                            <h2 class="text-white mb-0">{{ avg_orders_per_customer|default(0)|round(1) }}</h2>
                            <small class="text-white-50">Orders per customer</small>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Table -->
    <div class="card-admin">
        <div class="card-header-admin d-flex justify-content-between align-items-center">
            <h5>All Customers</h5>
            <div class="d-flex gap-2">
                <div class="input-group input-group-sm" style="width: 250px;">
                    <input type="text" id="searchInput" class="form-control-admin" placeholder="Search customers...">
                    <button class="btn btn-outline-secondary" type="button" onclick="searchCustomers()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <button class="btn btn-sm btn-primary-admin" onclick="exportCustomers()">
                    <i class="fas fa-download me-1"></i> Export
                </button>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="table table-admin table-hover" id="customersTable">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="selectAll" class="form-check-input">
                        </th>
                        <th>Customer ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Location</th>
                        <th>Orders</th>
                        <th>Joined</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if customers and customers|length > 0 %}
                        {% for customer in customers %}
                        <tr data-customer-id="{{ customer.id }}">
                            <td>
                                <input type="checkbox" class="customer-checkbox form-check-input" value="{{ customer.id }}">
                            </td>
                            <td>
                                <span class="fw-medium">#CUST{{ "%04d" % customer.id }}</span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="avatar me-2" 
                                         style="width: 35px; height: 35px; background: #{{ '%06x' % (customer.id * 123456) % 0xffffff }}; 
                                                color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                        {{ customer.first_name[0]|upper if customer.first_name else 'C' }}
                                    </div>
                                    <div>
                                        <div class="fw-medium">{{ customer.first_name }} {{ customer.last_name }}</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="text-truncate" style="max-width: 200px;">
                                    <a href="mailto:{{ customer.email }}" class="text-decoration-none">
                                        {{ customer.email }}
                                    </a>
                                </div>
                            </td>
                            <td>
                                {% if customer.phone %}
                                <a href="tel:{{ customer.phone }}" class="text-decoration-none">
                                    {{ customer.phone }}
                                </a>
                                {% else %}
                                <span class="text-muted">Not provided</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if customer.city or customer.state %}
                                <div class="text-truncate" style="max-width: 150px;">
                                    {{ customer.city or '' }}{% if customer.city and customer.state %}, {% endif %}{{ customer.state or '' }}
                                </div>
                                {% else %}
                                <span class="text-muted">Unknown</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if customer.orders and customer.orders|length > 0 %}
                                <span class="badge-admin bg-primary">
                                    {{ customer.orders|length }} order{% if customer.orders|length != 1 %}s{% endif %}
                                </span>
                                {% else %}
                                <span class="badge-admin bg-secondary">No orders</span>
                                {% endif %}
                            </td>
                            <td>
                                <div>{{ customer.created_at.strftime('%b %d, %Y') }}</div>
                                <small class="text-muted">{{ customer.created_at.strftime('%I:%M %p') }}</small>
                            </td>
                            <td>
                                <span class="badge-admin badge-success">Active</span>
                            </td>
                            <td>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewCustomerDetails({{ customer.id }})" 
                                            data-bs-toggle="tooltip" data-bs-placement="top" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" onclick="viewCustomerOrders({{ customer.id }})"
                                            data-bs-toggle="tooltip" data-bs-placement="top" title="View Orders">
                                        <i class="fas fa-shopping-bag"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" onclick="sendEmailToCustomer('{{ customer.email }}')"
                                            data-bs-toggle="tooltip" data-bs-placement="top" title="Send Email">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="10" class="text-center py-4">
                                <div class="empty-state">
                                    <i class="fas fa-users fa-3x text-muted mb-3"></i>
                                    <h5>No Customers Found</h5>
                                    <p class="text-muted mb-0">No customers have registered yet.</p>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if customers and customers|length > 0 %}
        <div class="card-footer border-top-0 bg-white">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <small class="text-muted">Showing {{ customers|length }} of {{ customers|length }} customers</small>
                </div>
                <nav>
                    <ul class="pagination pagination-sm mb-0">
                        <li class="page-item disabled">
                            <a class="page-link" href="#">Previous</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item disabled">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Bulk Actions -->
    <div class="card-admin mt-3" id="bulkActions" style="display: none;">
        <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
                <div>
                    <span id="selectedCount">0</span> customer(s) selected
                </div>
                <div class="d-flex gap-2">
                    <select class="form-select form-select-sm" style="width: auto;" id="bulkActionSelect">
                        <option value="">Bulk Actions</option>
                        <option value="export">Export Selected</option>
                        <option value="email">Send Email to Selected</option>
                        <option value="segment">Add to Segment</option>
                    </select>
                    <button class="btn btn-sm btn-primary-admin" onclick="applyBulkAction()">Apply</button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="clearSelection()">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Segments -->
    <div class="row mt-4">
        <div class="col-lg-4">
            <div class="card-admin">
                <div class="card-header-admin d-flex justify-content-between align-items-center">
                    <h5>Customer Segments</h5>
                    <button class="btn btn-sm btn-outline-primary" onclick="createSegment()">
                        <i class="fas fa-plus"></i> New
                    </button>
                </div>
                <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-star text-warning me-2"></i>
                            <span>VIP Customers</span>
                        </div>
                        <span class="badge-admin bg-primary">12</span>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-shopping-bag text-success me-2"></i>
                            <span>Recent Buyers</span>
                        </div>
                        <span class="badge-admin bg-success">8</span>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-clock text-info me-2"></i>
                            <span>Inactive (30+ days)</span>
                        </div>
                        <span class="badge-admin bg-info">5</span>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-gift text-danger me-2"></i>
                            <span>Birthday This Month</span>
                        </div>
                        <span class="badge-admin bg-danger">3</span>
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-8">
            <div class="card-admin h-100">
                <div class="card-header-admin">
                    <h5>Customer Locations</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="mb-3">Top Cities</h6>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Lagos</span>
                                    <span class="fw-medium">42%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" style="width: 42%; background-color: #667eea;"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Abuja</span>
                                    <span class="fw-medium">28%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" style="width: 28%; background-color: #764ba2;"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Port Harcourt</span>
                                    <span class="fw-medium">15%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" style="width: 15%; background-color: #f093fb;"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Ibadan</span>
                                    <span class="fw-medium">8%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" style="width: 8%; background-color: #f5576c;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h6 class="mb-3">Customer Growth</h6>
                            <div class="chart-container" style="height: 200px;">
                                <canvas id="customerGrowthChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Customer Details Modal -->
<div class="modal fade" id="customerDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Customer Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="customerDetailsContent">
                <!-- Customer details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="editCustomer()">Edit Customer</button>
            </div>
        </div>
    </div>
</div>

<!-- Customer Orders Modal -->
<div class="modal fade" id="customerOrdersModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Customer Orders</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="customerOrdersContent">
                <!-- Customer orders will be loaded here -->
            </div>
        </div>
    </div>
</div>

<style>
    .bg-stat-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .bg-stat-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .bg-stat-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .bg-stat-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
    }
    
    .empty-state i {
        opacity: 0.5;
    }
    
    .avatar {
        flex-shrink: 0;
    }
    
    .progress-bar {
        border-radius: 4px;
    }
    
    #bulkActions {
        animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    // Chart.js for Customer Growth
    let customerGrowthChart = null;
    
    document.addEventListener('DOMContentLoaded', function() {
        initCustomerGrowthChart();
        initEventListeners();
        initTooltips();
    });
    
    function initCustomerGrowthChart() {
        const ctx = document.getElementById('customerGrowthChart').getContext('2d');
        
        customerGrowthChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                datasets: [{
                    label: 'New Customers',
                    data: [12, 19, 15, 25, 22, 30, 28],
                    borderColor: '#8B4513',
                    backgroundColor: 'rgba(139, 69, 19, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            borderDash: [5, 5]
                        },
                        ticks: {
                            stepSize: 5
                        }
                    }
                }
            }
        });
    }
    
    function initEventListeners() {
        // Select All checkbox
        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.customer-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
            updateBulkActions();
        });
        
        // Individual checkboxes
        document.querySelectorAll('.customer-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', updateBulkActions);
        });
        
        // Search input
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchCustomers();
            }
        });
    }
    
    function initTooltips() {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
    }
    
    // Search Customers
    function searchCustomers() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.querySelectorAll('#customersTable tbody tr');
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    }
    
    // Bulk Actions
    function updateBulkActions() {
        const selectedCount = document.querySelectorAll('.customer-checkbox:checked').length;
        const bulkActionsDiv = document.getElementById('bulkActions');
        
        if (selectedCount > 0) {
            document.getElementById('selectedCount').textContent = selectedCount;
            bulkActionsDiv.style.display = 'block';
        } else {
            bulkActionsDiv.style.display = 'none';
        }
    }
    
    function clearSelection() {
        document.querySelectorAll('.customer-checkbox').forEach(checkbox => {
            checkbox.checked = false;
        });
        document.getElementById('selectAll').checked = false;
        updateBulkActions();
    }
    
    function applyBulkAction() {
        const action = document.getElementById('bulkActionSelect').value;
        const selectedIds = Array.from(document.querySelectorAll('.customer-checkbox:checked'))
            .map(checkbox => checkbox.value);
        
        if (!action) {
            showToast('Please select an action', 'warning');
            return;
        }
        
        if (selectedIds.length === 0) {
            showToast('No customers selected', 'warning');
            return;
        }
        
        switch(action) {
            case 'export':
                exportSelectedCustomers(selectedIds);
                break;
            case 'email':
                sendBulkEmail(selectedIds);
                break;
            case 'segment':
                addToSegment(selectedIds);
                break;
        }
    }
    
    // Export Functions
    function exportCustomers() {
        const customers = Array.from(document.querySelectorAll('#customersTable tbody tr')).map(row => {
            const cells = row.querySelectorAll('td');
            return {
                id: cells[1].textContent.trim(),
                name: cells[2].textContent.trim(),
                email: cells[3].textContent.trim(),
                phone: cells[4].textContent.trim(),
                location: cells[5].textContent.trim(),
                orders: cells[6].textContent.trim(),
                joined: cells[7].textContent.trim(),
                status: cells[8].textContent.trim()
            };
        });
        
        exportToCSV(customers, 'customers.csv');
    }
    
    function exportSelectedCustomers(ids) {
        const selectedCustomers = ids.map(id => {
            const row = document.querySelector(`tr[data-customer-id="${id}"]`);
            if (row) {
                const cells = row.querySelectorAll('td');
                return {
                    id: cells[1].textContent.trim(),
                    name: cells[2].textContent.trim(),
                    email: cells[3].textContent.trim(),
                    phone: cells[4].textContent.trim(),
                    location: cells[5].textContent.trim(),
                    orders: cells[6].textContent.trim(),
                    joined: cells[7].textContent.trim(),
                    status: cells[8].textContent.trim()
                };
            }
        }).filter(customer => customer);
        
        if (selectedCustomers.length === 0) {
            showToast('No customers to export', 'warning');
            return;
        }
        
        exportToCSV(selectedCustomers, `selected-customers-${new Date().toISOString().split('T')[0]}.csv`);
    }
    
    // View Customer Details
    function viewCustomerDetails(customerId) {
        showLoading();
        
        // In a real application, you would fetch customer details from the server
        // For now, we'll use the data from the table
        const row = document.querySelector(`tr[data-customer-id="${customerId}"]`);
        if (row) {
            const cells = row.querySelectorAll('td');
            const customerData = {
                id: customerId,
                name: cells[2].textContent.trim(),
                email: cells[3].textContent.trim(),
                phone: cells[4].textContent.trim(),
                location: cells[5].textContent.trim(),
                orders: cells[6].textContent.trim(),
                joined: cells[7].textContent.trim(),
                status: cells[8].textContent.trim()
            };
            
            const content = `
                <div class="row">
                    <div class="col-md-4 text-center mb-4">
                        <div class="avatar mx-auto mb-3" 
                             style="width: 100px; height: 100px; background: #{{ '%06x' % (customerId * 123456) % 0xffffff }}; 
                                    color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
                                    font-size: 2.5rem; font-weight: bold;">
                            ${customerData.name[0]}
                        </div>
                        <h5>${customerData.name}</h5>
                        <p class="text-muted mb-0">Customer ID: #CUST${customerId.toString().padStart(4, '0')}</p>
                    </div>
                    
                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-medium text-muted">Email Address</label>
                                <p class="mb-0">${customerData.email}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-medium text-muted">Phone Number</label>
                                <p class="mb-0">${customerData.phone}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-medium text-muted">Location</label>
                                <p class="mb-0">${customerData.location}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-medium text-muted">Account Status</label>
                                <p class="mb-0"><span class="badge-admin badge-success">Active</span></p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-medium text-muted">Total Orders</label>
                                <p class="mb-0">${customerData.orders}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-medium text-muted">Member Since</label>
                                <p class="mb-0">${customerData.joined}</p>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h6>Recent Activity</h6>
                            <div class="list-group list-group-flush">
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between">
                                        <span>Last Login</span>
                                        <span class="text-muted">Today, 10:30 AM</span>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between">
                                        <span>Last Order</span>
                                        <span class="text-muted">2 days ago</span>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between">
                                        <span>Total Spent</span>
                                        <span class="fw-medium">₦45,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('customerDetailsContent').innerHTML = content;
            
            const modal = new bootstrap.Modal(document.getElementById('customerDetailsModal'));
            modal.show();
        }
        
        hideLoading();
    }
    
    // View Customer Orders
    function viewCustomerOrders(customerId) {
        showLoading();
        
        // In a real application, you would fetch customer orders from the server
        // For now, we'll show a sample
        const content = `
            <div class="table-responsive">
                <table class="table table-admin">
                    <thead>
                        <tr>
                            <th>Order #</th>
                            <th>Date</th>
                            <th>Items</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>#NORA-20240115-ABC123</td>
                            <td>Jan 15, 2024</td>
                            <td>Brazilian Body Wave 24"</td>
                            <td>₦45,000</td>
                            <td><span class="badge-admin badge-success">Delivered</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary">View</button>
                            </td>
                        </tr>
                        <tr>
                            <td>#NORA-20240110-DEF456</td>
                            <td>Jan 10, 2024</td>
                            <td>Peruvian Straight 22"</td>
                            <td>₦38,500</td>
                            <td><span class="badge-admin badge-warning">Processing</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary">View</button>
                            </td>
                        </tr>
                        <tr>
                            <td>#NORA-20231228-GHI789</td>
                            <td>Dec 28, 2023</td>
                            <td>2x Brazilian Body Wave 24"</td>
                            <td>₦85,000</td>
                            <td><span class="badge-admin badge-success">Delivered</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary">View</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="text-center mt-3">
                <a href="{{ url_for('admin_orders') }}" class="btn btn-primary-admin">
                    <i class="fas fa-external-link-alt me-2"></i> View All Orders
                </a>
            </div>
        `;
        
        document.getElementById('customerOrdersContent').innerHTML = content;
        
        const modal = new bootstrap.Modal(document.getElementById('customerOrdersModal'));
        modal.show();
        
        hideLoading();
    }
    
    // Send Email
    function sendEmailToCustomer(email) {
        window.location.href = `mailto:${email}`;
    }
    
    function sendBulkEmail(customerIds) {
        showToast(`Preparing to send email to ${customerIds.length} customers...`, 'info');
        // In production, this would open an email composer or show a modal
    }
    
    // Segment Management
    function createSegment() {
        showToast('Creating new segment...', 'info');
        // In production, this would show a modal for segment creation
    }
    
    function addToSegment(customerIds) {
        showToast(`Adding ${customerIds.length} customers to segment...`, 'info');
        // In production, this would show a modal for segment selection
    }
    
    // Edit Customer
    function editCustomer() {
        showToast('Edit customer feature coming soon!', 'info');
    }
</script>
{% endblock %}
