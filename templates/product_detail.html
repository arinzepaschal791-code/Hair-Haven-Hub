<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - NoraHairLine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #8a6d3b;
            --primary-dark: #6b4f2b;
            --secondary: #f5f5f5;
            --dark: #333;
            --light: #fff;
            --gray: #888;
            --shadow: 0 5px 15px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--dark);
        }
        
        /* Header & Navigation */
        header {
            background-color: var(--light);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }
        
        .logo span {
            color: var(--dark);
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .nav-icons {
            display: flex;
            gap: 1.5rem;
        }
        
        .nav-icons a {
            color: var(--dark);
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .nav-icons a:hover {
            color: var(--primary);
        }
        
        .cart-count {
            background: var(--primary);
            color: white;
            border-radius: 50%;
            padding: 0.2rem 0.5rem;
            font-size: 0.8rem;
            position: relative;
            top: -8px;
            right: 5px;
        }
        
        /* Product Container */
        .product-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 5%;
        }
        
        .breadcrumb {
            margin-bottom: 2rem;
            color: var(--gray);
        }
        
        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .product-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            background: var(--light);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }
        
        /* Product Images */
        .product-images {
            position: relative;
        }
        
        .main-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 1rem;
            cursor: zoom-in;
        }
        
        .image-gallery {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 1rem;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            opacity: 0.7;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .thumbnail:hover, .thumbnail.active {
            opacity: 1;
            border-color: var(--primary);
        }
        
        /* Product Info */
        .product-info h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .product-category {
            color: var(--primary);
            text-transform: uppercase;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: rgba(138, 109, 59, 0.1);
            border-radius: 20px;
        }
        
        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .stars {
            color: #ffc107;
        }
        
        .rating-count {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .product-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .product-description {
            line-height: 1.8;
            margin-bottom: 2rem;
            color: #555;
        }
        
        /* Product Meta */
        .product-meta {
            margin-bottom: 2rem;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
            color: var(--dark);
        }
        
        .meta-item i {
            color: var(--primary);
            width: 20px;
        }
        
        .stock-status {
            display: inline-block;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .in-stock {
            background: #d4edda;
            color: #155724;
        }
        
        .low-stock {
            background: #fff3cd;
            color: #856404;
        }
        
        /* Product Actions */
        .product-actions {
            margin-bottom: 2rem;
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .qty-btn {
            width: 40px;
            height: 40px;
            background: #f9f9f9;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .qty-input {
            width: 60px;
            height: 40px;
            border: none;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.8rem 2rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--light);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-large {
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        /* Product Tabs */
        .product-tabs {
            margin-top: 3rem;
        }
        
        .tab-headers {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 2rem;
        }
        
        .tab-header {
            padding: 1rem 2rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }
        
        .tab-header.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            padding: 1.5rem 0;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        /* Reviews */
        .reviews-container {
            max-width: 800px;
        }
        
        .review-form {
            background: #f9f9f9;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .review-form h3 {
            margin-bottom: 1rem;
        }
        
        .rating-input {
            margin-bottom: 1rem;
        }
        
        .star-rating {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .star-rating i {
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .star-rating i.active {
            color: #ffc107;
        }
        
        .review-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .review-item {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .reviewer-name {
            font-weight: 600;
        }
        
        .review-date {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Related Products */
        .related-products {
            margin-top: 4rem;
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            text-align: center;
            color: var(--dark);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .product-card {
            background: var(--light);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-card-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .product-card-info {
            padding: 1.5rem;
        }
        
        .product-card-name {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .product-card-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: var(--light);
            padding: 4rem 5% 2rem;
            margin-top: 4rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .footer-section h3 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 0.8rem;
        }
        
        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-links a:hover {
            color: var(--primary);
            padding-left: 5px;
        }
        
        .copyright {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #444;
            color: #aaa;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .product-content {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .main-image {
                height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .tab-headers {
                flex-wrap: wrap;
            }
            
            .tab-header {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .product-content {
                padding: 1rem;
            }
            
            .product-info h1 {
                font-size: 1.8rem;
            }
            
            .product-price {
                font-size: 2rem;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="navbar">
            <a href="/" class="logo">Nora<span>HairLine</span></a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/shop">Shop</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/contact">Contact</a></li>
                {% if session.get('admin_logged_in') %}
                <li><a href="/admin/dashboard">Admin</a></li>
                {% endif %}
            </ul>
            <div class="nav-icons">
                <a href="/account"><i class="fas fa-user"></i></a>
                <a href="/cart"><i class="fas fa-shopping-cart"></i><span class="cart-count" id="cart-count">0</span></a>
                {% if session.get('admin_logged_in') %}
                <a href="/logout"><i class="fas fa-sign-out-alt"></i></a>
                {% else %}
                <a href="/login"><i class="fas fa-sign-in-alt"></i></a>
                {% endif %}
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="product-container">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="/">Home</a> › <a href="/shop">Shop</a> › <span id="breadcrumb-category">Category</span> › <span id="breadcrumb-name">Product Name</span>
        </div>

        <!-- Product Details -->
        <div class="product-content">
            <!-- Product Images -->
            <div class="product-images">
                <img src="" alt="Product Image" class="main-image" id="main-image">
                <div class="image-gallery" id="image-gallery">
                    <!-- Thumbnails will be loaded here -->
                </div>
            </div>

            <!-- Product Info -->
            <div class="product-info">
                <h1 id="product-name">Loading...</h1>
                <div class="product-category" id="product-category">Category</div>
                
                <div class="product-rating">
                    <div class="stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                    </div>
                    <span class="rating-count" id="review-count">(0 reviews)</span>
                </div>
                
                <div class="product-price" id="product-price">$0.00</div>
                
                <div class="product-description" id="product-description">
                    Loading product description...
                </div>
                
                <div class="product-meta">
                    <div class="meta-item">
                        <i class="fas fa-box"></i>
                        <span>Availability: <span class="stock-status in-stock" id="stock-status">In Stock</span></span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-tag"></i>
                        <span>SKU: <span id="product-sku">NORA-001</span></span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-calendar"></i>
                        <span>Added: <span id="product-date">Just now</span></span>
                    </div>
                </div>
                
                <div class="product-actions">
                    <div class="quantity-selector">
                        <label for="quantity">Quantity:</label>
                        <div class="quantity-control">
                            <button class="qty-btn" onclick="updateQuantity(-1)">-</button>
                            <input type="number" class="qty-input" id="quantity" value="1" min="1" max="100">
                            <button class="qty-btn" onclick="updateQuantity(1)">+</button>
                        </div>
                        <span id="max-stock" style="color: var(--gray); font-size: 0.9rem;"></span>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary btn-large" onclick="addToCart()">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                        <button class="btn btn-outline btn-large" onclick="addToWishlist()">
                            <i class="fas fa-heart"></i> Add to Wishlist
                        </button>
                        {% if session.get('admin_logged_in') %}
                        <a href="/admin/products?id=" id="edit-product" class="btn btn-outline btn-large">
                            <i class="fas fa-edit"></i> Edit Product
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Tabs -->
        <div class="product-tabs">
            <div class="tab-headers">
                <div class="tab-header active" onclick="switchTab('description')">Description</div>
                <div class="tab-header" onclick="switchTab('details')">Details</div>
                <div class="tab-header" onclick="switchTab('reviews')">Reviews (<span id="reviews-count">0</span>)</div>
                <div class="tab-header" onclick="switchTab('shipping')">Shipping & Returns</div>
            </div>
            
            <div class="tab-content">
                <div class="tab-pane active" id="tab-description">
                    <div id="full-description">
                        <!-- Full description will be loaded here -->
                    </div>
                </div>
                
                <div class="tab-pane" id="tab-details">
                    <h3>Product Specifications</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                        <tbody id="specifications-table">
                            <!-- Specifications will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="tab-pane" id="tab-reviews">
                    <div class="reviews-container">
                        <div class="review-form">
                            <h3>Write a Review</h3>
                            <div class="rating-input">
                                <label>Your Rating:</label>
                                <div class="star-rating" id="star-rating">
                                    <i class="fas fa-star" data-rating="1"></i>
                                    <i class="fas fa-star" data-rating="2"></i>
                                    <i class="fas fa-star" data-rating="3"></i>
                                    <i class="fas fa-star" data-rating="4"></i>
                                    <i class="fas fa-star" data-rating="5"></i>
                                </div>
                            </div>
                            <textarea id="review-text" placeholder="Write your review here..." 
                                      style="width: 100%; padding: 1rem; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 1rem; min-height: 100px;"></textarea>
                            <button class="btn btn-primary" onclick="submitReview()">Submit Review</button>
                        </div>
                        
                        <div class="review-list" id="review-list">
                            <!-- Reviews will be loaded here -->
                            <p style="text-align: center; color: var(--gray);">No reviews yet. Be the first to review this product!</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane" id="tab-shipping">
                    <h3>Shipping Information</h3>
                    <p>We offer worldwide shipping with the following options:</p>
                    <ul style="margin: 1rem 0 1rem 2rem;">
                        <li>Standard Shipping: 5-7 business days</li>
                        <li>Express Shipping: 2-3 business days</li>
                        <li>Overnight Shipping: 1 business day</li>
                    </ul>
                    
                    <h3>Returns Policy</h3>
                    <p>We offer a 30-day return policy for all products:</p>
                    <ul style="margin: 1rem 0 1rem 2rem;">
                        <li>Items must be in original condition</li>
                        <li>Return shipping is free for defective items</li>
                        <li>Refunds processed within 5-7 business days</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <div class="related-products">
            <h2 class="section-title">You May Also Like</h2>
            <div class="products-grid" id="related-products">
                <!-- Related products will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>NoraHairLine</h3>
                <p>Your destination for premium quality hair products and accessories.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/shop">Shop</a></li>
                    <li><a href="/about">About Us</a></li>
                    <li><a href="/contact">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Info</h3>
                <p><i class="fas fa-map-marker-alt"></i> 123 Beauty Street, Hair City</p>
                <p><i class="fas fa-phone"></i> (555) 123-4567</p>
                <p><i class="fas fa-envelope"></i> info@norahairline.com</p>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2024 NoraHairLine. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let productId = null;
        let currentProduct = null;
        let selectedRating = 0;
        
        // Get product ID from URL
        function getProductIdFromUrl() {
            const path = window.location.pathname.split('/');
            return path[path.length - 1];
        }
        
        // Load product data
        async function loadProduct() {
            productId = getProductIdFromUrl();
            
            if (!productId || isNaN(productId)) {
                document.querySelector('.product-content').innerHTML = '<h2>Product not found</h2><p>Sorry, the product you are looking for does not exist.</p>';
                return;
            }
            
            try {
                // Load product details
                const response = await fetch(`/api/products/${productId}`);
                const product = await response.json();
                
                if (product.error) {
                    throw new Error(product.error);
                }
                
                currentProduct = product;
                displayProduct(product);
                
                // Load related products
                loadRelatedProducts(product.category);
                
                // Load reviews if available
                if (HAS_REVIEW) {
                    loadProductReviews();
                }
                
                // Update cart count
                updateCartCount();
                
            } catch (error) {
                console.error('Error loading product:', error);
                document.querySelector('.product-content').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 4rem;">
                        <h2>Error Loading Product</h2>
                        <p>${error.message}</p>
                        <a href="/shop" class="btn btn-primary" style="margin-top: 1rem;">Continue Shopping</a>
                    </div>
                `;
            }
        }
        
        // Display product information
        function displayProduct(product) {
            // Update breadcrumb
            document.getElementById('breadcrumb-category').textContent = product.category.charAt(0).toUpperCase() + product.category.slice(1);
            document.getElementById('breadcrumb-name').textContent = product.name;
            
            // Update product info
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-category').textContent = product.category.toUpperCase();
            document.getElementById('product-price').textContent = `$${product.price.toFixed(2)}`;
            document.getElementById('product-description').textContent = product.description;
            document.getElementById('full-description').innerHTML = `<p>${product.description}</p>`;
            
            // Update stock info
            const stockStatus = document.getElementById('stock-status');
            const maxStock = document.getElementById('max-stock');
            if (product.stock > 10) {
                stockStatus.textContent = 'In Stock';
                stockStatus.className = 'stock-status in-stock';
                maxStock.textContent = `${product.stock} available`;
            } else if (product.stock > 0) {
                stockStatus.textContent = 'Low Stock';
                stockStatus.className = 'stock-status low-stock';
                maxStock.textContent = `Only ${product.stock} left!`;
            } else {
                stockStatus.textContent = 'Out of Stock';
                stockStatus.className = 'stock-status out-of-stock';
                maxStock.textContent = 'Currently unavailable';
                document.querySelector('.qty-input').disabled = true;
                document.querySelector('.qty-btn').disabled = true;
            }
            
            // Update SKU
            document.getElementById('product-sku').textContent = product.sku || `NORA-${product.id}`;
            
            // Update date
            if (product.created_at) {
                const date = new Date(product.created_at);
                document.getElementById('product-date').textContent = date.toLocaleDateString();
            }
            
            // Update edit link for admin
            const editLink = document.getElementById('edit-product');
            if (editLink) {
                editLink.href = `/admin/products?id=${product.id}`;
            }
            
            // Update images
            updateProductImages(product);
            
            // Update specifications
            updateSpecifications(product);
        }
        
        // Update product images
        function updateProductImages(product) {
            const mainImage = document.getElementById('main-image');
            const gallery = document.getElementById('image-gallery');
            
            // Set main image
            mainImage.src = product.image_url || '/static/images/placeholder.jpg';
            mainImage.alt = product.name;
            
            // Create thumbnails
            gallery.innerHTML = '';
            
            // Main image as first thumbnail
            addThumbnail(product.image_url || '/static/images/placeholder.jpg', mainImage, 0);
            
            // Add additional image placeholders
            for (let i = 1; i <= 3; i++) {
                addThumbnail(`/static/images/hair${i}.jpg`, mainImage, i);
            }
        }
        
        // Add thumbnail to gallery
        function addThumbnail(src, mainImage, index) {
            const gallery = document.getElementById('image-gallery');
            const thumbnail = document.createElement('img');
            thumbnail.src = src;
            thumbnail.className = `thumbnail ${index === 0 ? 'active' : ''}`;
            thumbnail.onclick = function() {
                mainImage.src = src;
                // Update active thumbnail
                document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            };
            gallery.appendChild(thumbnail);
        }
        
        // Update specifications
        function updateSpecifications(product) {
            const table = document.getElementById('specifications-table');
            const specs = [
                { label: 'Material', value: '100% Human Hair' },
                { label: 'Length', value: product.name.includes('24"') ? '24 inches' : 
                                         product.name.includes('22"') ? '22 inches' : 
                                         product.name.includes('26"') ? '26 inches' : 'Varies' },
                { label: 'Texture', value: product.name.includes('Straight') ? 'Bone Straight' : 
                                          product.name.includes('Curly') ? 'Curly' : 
                                          product.name.includes('Silk') ? 'Silk Press' : 'Natural' },
                { label: 'Origin', value: product.name.includes('Brazilian') ? 'Brazil' : 'Various' },
                { label: 'Weight', value: 'Approx. 100-150g' },
                { label: 'Can be Colored', value: 'Yes' },
                { label: 'Can be Styled', value: 'Yes' }
            ];
            
            table.innerHTML = specs.map(spec => `
                <tr>
                    <td style="padding: 0.8rem; border-bottom: 1px solid #eee; font-weight: 600; width: 200px;">${spec.label}</td>
                    <td style="padding: 0.8rem; border-bottom: 1px solid #eee;">${spec.value}</td>
                </tr>
            `).join('');
        }
        
        // Load related products
        async function loadRelatedProducts(category) {
            try {
                const response = await fetch(`/api/products?category=${category}`);
                const products = await response.json();
                
                if (products.error) {
                    throw new Error(products.error);
                }
                
                // Filter out current product and limit to 4
                const related = products.filter(p => p.id != productId).slice(0, 4);
                const container = document.getElementById('related-products');
                
                if (related.length === 0) {
                    container.innerHTML = '<p style="text-align: center; grid-column: 1/-1; color: var(--gray);">No related products found.</p>';
                    return;
                }
                
                container.innerHTML = related.map(product => `
                    <div class="product-card">
                        <img src="${product.image_url || '/static/images/placeholder.jpg'}" 
                             alt="${product.name}" 
                             class="product-card-img">
                        <div class="product-card-info">
                            <h3 class="product-card-name">${product.name}</h3>
                            <div class="product-card-price">$${product.price.toFixed(2)}</div>
                            <a href="/product/${product.id}" class="btn btn-outline" style="width: 100%;">
                                <i class="fas fa-eye"></i> View Details
                            </a>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading related products:', error);
            }
        }
        
        // Load product reviews
        async function loadProductReviews() {
            try {
                const response = await fetch(`/api/products/${productId}/reviews`);
                const reviews = await response.json();
                
                if (reviews.error) {
                    throw new Error(reviews.error);
                }
                
                updateReviewsDisplay(reviews);
                
            } catch (error) {
                console.error('Error loading reviews:', error);
            }
        }
        
        // Update reviews display
        function updateReviewsDisplay(reviews) {
            const container = document.getElementById('review-list');
            const countElement = document.getElementById('reviews-count');
            const reviewCountElement = document.getElementById('review-count');
            
            countElement.textContent = reviews.length;
            reviewCountElement.textContent = `(${reviews.length} reviews)`;
            
            if (reviews.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray);">No reviews yet. Be the first to review this product!</p>';
                return;
            }
            
            // Calculate average rating
            const averageRating = reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length;
            updateStarRating(averageRating);
            
            // Display reviews
            container.innerHTML = reviews.map(review => `
                <div class="review-item">
                    <div class="review-header">
                        <div class="reviewer-name">${review.customer_name}</div>
                        <div class="review-date">${new Date(review.created_at).toLocaleDateString()}</div>
                    </div>
                    <div class="star-rating" style="margin-bottom: 0.5rem;">
                        ${Array(5).fill().map((_, i) => 
                            `<i class="fas fa-star ${i < review.rating ? 'active' : ''}" style="font-size: 1rem;"></i>`
                        ).join('')}
                    </div>
                    <p>${review.comment}</p>
                </div>
            `).join('');
        }
        
        // Update star rating display
        function updateStarRating(rating) {
            const stars = document.querySelectorAll('#tab-reviews .star-rating i');
            stars.forEach((star, index) => {
                if (index < Math.floor(rating)) {
                    star.classList.add('active');
                } else if (index === Math.floor(rating) && rating % 1 >= 0.5) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }
        
        // Switch between tabs
        function switchTab(tabName) {
            // Update tab headers
            document.querySelectorAll('.tab-header').forEach(header => {
                header.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Load reviews if needed
            if (tabName === 'reviews' && HAS_REVIEW) {
                loadProductReviews();
            }
        }
        
        // Update quantity
        function updateQuantity(change) {
            const input = document.getElementById('quantity');
            let value = parseInt(input.value) + change;
            const maxStock = currentProduct.stock;
            
            if (value < 1) value = 1;
            if (value > maxStock) value = maxStock;
            
            input.value = value;
        }
        
        // Add to cart
        function addToCart() {
            const quantity = parseInt(document.getElementById('quantity').value);
            
            if (!currentProduct) {
                alert('Product information not loaded yet.');
                return;
            }
            
            if (currentProduct.stock === 0) {
                alert('Sorry, this product is out of stock.');
                return;
            }
            
            if (quantity > currentProduct.stock) {
                alert(`Only ${currentProduct.stock} items available in stock.`);
                return;
            }
            
            // Get existing cart or create new one
            let cart = JSON.parse(localStorage.getItem('norahair_cart')) || [];
            
            // Check if product already in cart
            const existingIndex = cart.findIndex(item => item.productId === currentProduct.id);
            
            if (existingIndex !== -1) {
                // Update quantity
                cart[existingIndex].quantity += quantity;
            } else {
                // Add new item
                cart.push({
                    productId: currentProduct.id,
                    quantity: quantity,
                    name: currentProduct.name,
                    price: currentProduct.price,
                    image: currentProduct.image_url
                });
            }
            
            // Save cart
            localStorage.setItem('norahair_cart', JSON.stringify(cart));
            
            // Update cart count
            updateCartCount();
            
            // Show success message
            alert(`${quantity} ${currentProduct.name} added to cart!`);
        }
        
        // Add to wishlist
        function addToWishlist() {
            alert('Added to wishlist! (Feature to be implemented)');
        }
        
        // Update cart count
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('norahair_cart')) || [];
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
        }
        
        // Submit review
        function submitReview() {
            if (selectedRating === 0) {
                alert('Please select a rating');
                return;
            }
            
            const reviewText = document.getElementById('review-text').value.trim();
            if (!reviewText) {
                alert('Please write a review');
                return;
            }
            
            // Note: You'll need to implement review submission API
            alert('Review submitted! (Feature to be implemented with backend)');
            
            // Clear form
            document.getElementById('review-text').value = '';
            resetStarRating();
        }
        
        // Setup star rating interaction
        function setupStarRating() {
            const stars = document.querySelectorAll('#star-rating i');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    selectedRating = parseInt(this.dataset.rating);
                    updateReviewStars(selectedRating);
                });
                
                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.dataset.rating);
                    updateReviewStars(rating, true);
                });
                
                star.addEventListener('mouseout', function() {
                    updateReviewStars(selectedRating, false);
                });
            });
        }
        
        // Update review stars
        function updateReviewStars(rating, isHover = false) {
            const stars = document.querySelectorAll('#star-rating i');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            
            if (!isHover) {
                selectedRating = rating;
            }
        }
        
        // Reset star rating
        function resetStarRating() {
            selectedRating = 0;
            updateReviewStars(0);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadProduct();
            setupStarRating();
            
            // Update quantity input validation
            document.getElementById('quantity').addEventListener('change', function() {
                let value = parseInt(this.value);
                const maxStock = currentProduct ? currentProduct.stock : 100;
                
                if (isNaN(value) || value < 1) value = 1;
                if (value > maxStock) value = maxStock;
                
                this.value = value;
            });
        });
    </script>
</body>
</html>
