{% extends "base.html" %}

{% block title %}{{ brand_name }} - {{ tagline }}{% endblock %}

{% block styles %}
<style>
    /* Hero Section */
    .hero-section {
        position: relative;
        padding: var(--spacing-xxl) 0;
        background: linear-gradient(rgba(26, 26, 26, 0.85), rgba(26, 26, 26, 0.95)), 
                    url('https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
        background-size: cover;
        background-position: center;
        color: white;
        margin-top: 76px;
        overflow: hidden;
    }

    .hero-content {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
        position: relative;
        z-index: 2;
    }

    .hero-title {
        font-size: 3.5rem;
        margin-bottom: var(--spacing-md);
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .hero-subtitle {
        font-size: 1.5rem;
        margin-bottom: var(--spacing-xl);
        color: var(--accent-gold);
        font-weight: 500;
    }

    .hero-description {
        font-size: 1.2rem;
        margin-bottom: var(--spacing-xl);
        color: rgba(255, 255, 255, 0.9);
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    .hero-buttons {
        display: flex;
        gap: var(--spacing-md);
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: var(--spacing-xxl);
    }

    .hero-stats {
        display: flex;
        justify-content: center;
        gap: var(--spacing-xl);
        flex-wrap: wrap;
        padding-top: var(--spacing-xl);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .hero-stat {
        text-align: center;
        min-width: 150px;
    }

    .hero-stat-number {
        display: block;
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--accent-gold);
        margin-bottom: var(--spacing-xs);
    }

    .hero-stat-label {
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.8);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Wholesale Banner */
    .wholesale-banner {
        background: linear-gradient(45deg, var(--primary-color), var(--accent-gold));
        color: white;
        padding: var(--spacing-lg);
        border-radius: var(--border-radius-lg);
        margin: var(--spacing-xl) auto;
        max-width: 1200px;
        box-shadow: var(--shadow-lg);
    }

    /* Categories Section */
    .category-card {
        position: relative;
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        height: 300px;
        cursor: pointer;
        transition: all var(--transition-normal);
        box-shadow: var(--shadow-md);
    }

    .category-card:hover {
        transform: translateY(-10px);
        box-shadow: var(--shadow-xl);
    }

    .category-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform var(--transition-normal);
    }

    .category-card:hover .category-image {
        transform: scale(1.1);
    }

    .category-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.9));
        color: white;
        padding: var(--spacing-xl) var(--spacing-lg) var(--spacing-lg);
    }

    .category-count {
        background: var(--accent-gold);
        color: var(--secondary-color);
        padding: 0.5rem 1.5rem;
        border-radius: 20px;
        font-weight: 600;
        display: inline-block;
        margin-top: var(--spacing-sm);
        font-size: 0.9rem;
    }

    /* Countdown Timer */
    .countdown-timer {
        background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
        color: white;
        padding: var(--spacing-xl);
        border-radius: var(--border-radius-lg);
        text-align: center;
        margin: var(--spacing-xl) 0;
        box-shadow: var(--shadow-lg);
    }

    .timer-title {
        font-size: 1.3rem;
        margin-bottom: var(--spacing-lg);
        color: var(--accent-gold);
    }

    .timer-numbers {
        display: flex;
        justify-content: center;
        gap: var(--spacing-lg);
        font-family: 'Courier New', monospace;
    }

    .timer-unit {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 80px;
    }

    .timer-value {
        font-size: 2.5rem;
        font-weight: 700;
        background: rgba(255, 255, 255, 0.1);
        padding: var(--spacing-md);
        border-radius: var(--border-radius-md);
        min-width: 80px;
    }

    .timer-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-top: var(--spacing-xs);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Trust Badges */
    .trust-badges {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--spacing-lg);
        margin: var(--spacing-xl) 0;
    }

    .trust-badge {
        text-align: center;
        padding: var(--spacing-xl);
        background: white;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-md);
        transition: transform var(--transition-normal);
    }

    .trust-badge:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }

    .badge-icon {
        font-size: 3rem;
        color: var(--accent-gold);
        margin-bottom: var(--spacing-md);
    }

    /* Testimonial Slider */
    .testimonial-slider {
        position: relative;
        overflow: hidden;
        margin: var(--spacing-xl) 0;
    }

    .testimonial-track {
        display: flex;
        transition: transform 0.5s ease;
    }

    .testimonial-slide {
        min-width: 100%;
        padding: 0 var(--spacing-md);
    }

    .review-card {
        background: white;
        border-radius: var(--border-radius-lg);
        padding: var(--spacing-xl);
        box-shadow: var(--shadow-md);
        text-align: center;
        border-left: 4px solid var(--accent-gold);
    }

    .review-stars {
        color: #FFD700;
        font-size: 1.2rem;
        margin-bottom: var(--spacing-md);
    }

    .review-text {
        font-style: italic;
        color: var(--gray-color);
        margin-bottom: var(--spacing-lg);
        font-size: 1.1rem;
        line-height: 1.6;
    }

    .review-author {
        margin-top: var(--spacing-lg);
        padding-top: var(--spacing-md);
        border-top: 1px solid var(--light-gray);
    }

    .customer-name {
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: var(--spacing-xs);
    }

    .slider-controls {
        display: flex;
        justify-content: center;
        gap: var(--spacing-md);
        margin-top: var(--spacing-lg);
    }

    .slider-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--light-color);
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: var(--primary-color);
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .slider-btn:hover {
        background: var(--primary-color);
        color: white;
    }

    /* Newsletter Section */
    .newsletter-section {
        background: linear-gradient(rgba(26, 26, 26, 0.9), rgba(26, 26, 26, 0.95)), 
                    url('https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
        background-size: cover;
        background-position: center;
        color: white;
        padding: var(--spacing-xxl) var(--spacing-xl);
        border-radius: var(--border-radius-lg);
        margin: var(--spacing-xxl) 0;
    }

    .newsletter-form .input-group {
        max-width: 500px;
        margin: 0 auto;
    }

    /* Instagram Feed */
    .instagram-feed {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: var(--spacing-md);
        margin-top: var(--spacing-xl);
    }

    .instagram-item {
        position: relative;
        border-radius: var(--border-radius-md);
        overflow: hidden;
        aspect-ratio: 1;
        box-shadow: var(--shadow-md);
    }

    .instagram-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform var(--transition-normal);
    }

    .instagram-item:hover img {
        transform: scale(1.1);
    }

    .instagram-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(138, 109, 59, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity var(--transition-normal);
    }

    .instagram-item:hover .instagram-overlay {
        opacity: 1;
    }

    .instagram-icon {
        color: white;
        font-size: 2rem;
    }

    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.5rem;
        }
        
        .hero-subtitle {
            font-size: 1.3rem;
        }
        
        .hero-description {
            font-size: 1.1rem;
        }
        
        .hero-buttons {
            flex-direction: column;
            align-items: center;
        }
        
        .hero-buttons .btn {
            width: 100%;
            max-width: 300px;
        }
        
        .hero-stats {
            gap: var(--spacing-lg);
        }
        
        .hero-stat {
            min-width: 120px;
        }
        
        .hero-stat-number {
            font-size: 2rem;
        }
        
        .timer-numbers {
            gap: var(--spacing-sm);
        }
        
        .timer-unit {
            min-width: 70px;
        }
        
        .timer-value {
            font-size: 1.8rem;
            padding: var(--spacing-sm);
        }
        
        .category-card {
            height: 250px;
        }
    }

    @media (max-width: 576px) {
        .hero-title {
            font-size: 2rem;
        }
        
        .hero-subtitle {
            font-size: 1.1rem;
        }
        
        .timer-numbers {
            flex-wrap: wrap;
        }
        
        .timer-unit {
            min-width: 60px;
        }
        
        .timer-value {
            font-size: 1.5rem;
            min-width: 60px;
        }
        
        .trust-badges {
            grid-template-columns: 1fr;
        }
        
        .instagram-feed {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="hero-content animate-fade-in">
            <h1 class="hero-title">{{ brand_name }}</h1>
            <h2 class="hero-subtitle">{{ tagline }}</h2>
            <p class="hero-description">
                Premium 100% human hair extensions, wigs, and hair care products at wholesale prices. 
                Experience luxury that transforms your look.
            </p>
            
            <div class="hero-buttons">
                <a href="/shop" class="btn btn-accent btn-lg">
                    <i class="fas fa-shopping-bag me-2"></i> Shop Now
                </a>
                <a href="{{ whatsapp }}" target="_blank" class="btn btn-whatsapp btn-lg">
                    <i class="fab fa-whatsapp me-2"></i> Order on WhatsApp
                </a>
            </div>
            
            <div class="hero-stats">
                <div class="hero-stat">
                    <span class="hero-stat-number">{{ total_products }}+</span>
                    <span class="hero-stat-label">Premium Products</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-number">{{ categories.hair }}+</span>
                    <span class="hero-stat-label">Hair Styles</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-number">{{ categories.wigs }}+</span>
                    <span class="hero-stat-label">Wigs</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-number">{{ categories.care }}+</span>
                    <span class="hero-stat-label">Hair Care</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Wholesale Banner -->
<div class="container">
    <div class="wholesale-banner">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h4 class="mb-2"><i class="fas fa-tag me-2"></i> {{ wholesale }}</h4>
                <p class="mb-0">Bulk orders available with special wholesale discounts</p>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="{{ whatsapp }}?text=Hello! I'm interested in wholesale prices" 
                   target="_blank" 
                   class="btn btn-light btn-lg">
                    <i class="fas fa-store me-2"></i> Wholesale Inquiry
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Categories Section -->
<section class="py-5">
    <div class="container">
        <h2 class="section-title">Shop by Category</h2>
        <p class="section-subtitle">Discover our premium collection of hair products</p>
        
        <div class="row g-4">
            <div class="col-md-4">
                <a href="/shop?category=hair" class="category-card">
                    <img src="https://images.unsplash.com/photo-1596703923338-48f1c07e4f2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                         alt="Hair Extensions" class="category-image">
                    <div class="category-overlay">
                        <h3>Hair Extensions</h3>
                        <div class="category-count">{{ categories.hair }} Products</div>
                    </div>
                </a>
            </div>
            
            <div class="col-md-4">
                <a href="/shop?category=wigs" class="category-card">
                    <img src="https://images.unsplash.com/photo-1629198720835-ade073825b81?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                         alt="Wigs" class="category-image">
                    <div class="category-overlay">
                        <h3>Wigs & Frontals</h3>
                        <div class="category-count">{{ categories.wigs }} Products</div>
                    </div>
                </a>
            </div>
            
            <div class="col-md-4">
                <a href="/shop?category=care" class="category-card">
                    <img src="https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                         alt="Hair Care" class="category-image">
                    <div class="category-overlay">
                        <h3>Hair Care</h3>
                        <div class="category-count">{{ categories.care }} Products</div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Countdown Timer -->
<section class="py-4">
    <div class="container">
        <div class="countdown-timer">
            <div class="timer-title">
                <i class="fas fa-bolt me-2"></i> FLASH SALE ENDS IN:
            </div>
            <div class="timer-numbers" id="countdownTimer">
                <div class="timer-unit">
                    <span class="timer-value" id="days">00</span>
                    <span class="timer-label">Days</span>
                </div>
                <div class="timer-unit">
                    <span class="timer-value" id="hours">00</span>
                    <span class="timer-label">Hours</span>
                </div>
                <div class="timer-unit">
                    <span class="timer-value" id="minutes">00</span>
                    <span class="timer-label">Minutes</span>
                </div>
                <div class="timer-unit">
                    <span class="timer-value" id="seconds">00</span>
                    <span class="timer-label">Seconds</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Products -->
<section class="py-5">
    <div class="container">
        <h2 class="section-title">Featured Products</h2>
        <p class="section-subtitle">Our best-selling premium hair products</p>
        
        {% if featured_products %}
        <div class="products-grid">
            {% for product in featured_products %}
            <div class="product-card {% if product.featured %}featured{% endif %}">
                <div class="product-image">
                    <img src="{{ product.image_url or '/static/images/default-product.jpg' }}" 
                         alt="{{ product.name }}"
                         data-src="{{ product.image_url or '/static/images/default-product.jpg' }}"
                         class="lazy">
                    <div class="product-badges">
                        {% if product.featured %}
                        <span class="product-badge featured">Featured</span>
                        {% endif %}
                        <span class="product-badge category">{{ product.category|title }}</span>
                        {% if product.stock > 0 %}
                        <span class="product-badge stock">In Stock</span>
                        {% else %}
                        <span class="product-badge out-of-stock">Out of Stock</span>
                        {% endif %}
                    </div>
                    
                    <div class="product-actions-overlay">
                        <button class="btn btn-primary btn-sm quick-view-btn" 
                                data-product-id="{{ product.id }}"
                                data-product-name="{{ product.name }}">
                            <i class="fas fa-eye me-1"></i> Quick View
                        </button>
                    </div>
                </div>
                
                <div class="product-content">
                    <h3 class="product-title">{{ product.name }}</h3>
                    <p class="product-description">
                        {{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}
                    </p>
                    
                    <div class="product-price">
                        <div>
                            <span class="price-amount">{{ product.formatted_price }}</span>
                        </div>
                        <div>
                            <span class="badge bg-success">
                                <i class="fas fa-check-circle me-1"></i> 100% Human Hair
                            </span>
                        </div>
                    </div>
                    
                    <div class="product-actions">
                        <a href="/product/{{ product.id }}" class="btn btn-outline-primary">
                            <i class="fas fa-info-circle me-1"></i> Details
                        </a>
                        <button class="btn btn-primary add-to-cart-btn" 
                                data-product-id="{{ product.id }}"
                                {% if product.stock <= 0 %}disabled{% endif %}>
                            <i class="fas fa-cart-plus me-1"></i> 
                            {% if product.stock > 0 %}Add to Cart{% else %}Out of Stock{% endif %}
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-5">
            <a href="/shop" class="btn btn-accent btn-lg">
                <i class="fas fa-store me-2"></i> View All Products
            </a>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-box-open fa-4x text-muted mb-4"></i>
            <h3>No Featured Products Available</h3>
            <p class="text-muted">Check back soon for our latest products!</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- Trust Badges -->
<section class="py-5 bg-lighter">
    <div class="container">
        <div class="trust-badges">
            <div class="trust-badge">
                <div class="badge-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h5>100% Authentic Hair</h5>
                <p class="text-muted">Premium quality 100% human hair guaranteed</p>
            </div>
            
            <div class="trust-badge">
                <div class="badge-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <h5>Nationwide Delivery</h5>
                <p class="text-muted">Fast shipping across all states in Nigeria</p>
            </div>
            
            <div class="trust-badge">
                <div class="badge-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h5>Secure Payment</h5>
                <p class="text-muted">Bank transfer with payment confirmation</p>
            </div>
            
            <div class="trust-badge">
                <div class="badge-icon">
                    <i class="fas fa-headset"></i>
                </div>
                <h5>24/7 Support</h5>
                <p class="text-muted">WhatsApp support available anytime</p>
            </div>
        </div>
    </div>
</section>

<!-- Customer Reviews -->
{% if reviews %}
<section class="py-5">
    <div class="container">
        <h2 class="section-title">Customer Reviews</h2>
        <p class="section-subtitle">What our customers are saying about us</p>
        
        <div class="testimonial-slider">
            <div class="testimonial-track" id="testimonialTrack">
                {% for review in reviews %}
                <div class="testimonial-slide">
                    <div class="review-card">
                        <div class="review-stars">
                            {% for i in range(5) %}
                                {% if i < review.rating %}
                                <i class="fas fa-star"></i>
                                {% else %}
                                <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        <blockquote class="review-text">
                            "{{ review.comment }}"
                        </blockquote>
                        
                        <div class="review-author">
                            <div class="customer-name">{{ review.customer_name }}</div>
                            <small class="text-muted">
                                {% if review.created_at %}
                                {{ review.created_at.strftime('%B %d, %Y') }}
                                {% endif %}
                            </small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="slider-controls">
                <button class="slider-btn" id="prevTestimonial">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="slider-btn" id="nextTestimonial">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Newsletter Section -->
<section class="py-5">
    <div class="container">
        <div class="newsletter-section rounded-lg">
            <div class="row align-items-center">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h2 class="text-white mb-3">Stay Updated</h2>
                    <p class="text-light mb-4">
                        Subscribe to our newsletter for exclusive offers, new arrivals, 
                        hair care tips, and wholesale discounts.
                    </p>
                    <div class="d-flex align-items-center text-light">
                        <i class="fas fa-gift fa-2x me-3 text-accent"></i>
                        <div>
                            <h5 class="mb-1">Get 10% Off Your First Order</h5>
                            <p class="small mb-0">Subscribe to claim your discount code</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <form id="newsletterForm" class="newsletter-form">
                        <div class="input-group mb-3">
                            <input type="email" class="form-control form-control-lg" 
                                   placeholder="Enter your email address" required>
                            <button class="btn btn-accent btn-lg" type="submit">
                                <i class="fas fa-paper-plane me-2"></i> Subscribe
                            </button>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="newsletterConsent" required>
                            <label class="form-check-label text-light small" for="newsletterConsent">
                                I agree to receive marketing emails from {{ brand_name }}
                            </label>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Instagram Feed -->
<section class="py-5 bg-light">
    <div class="container">
        <h2 class="section-title">Follow Us on Instagram</h2>
        <p class="section-subtitle">@{{ instagram.replace('@', '') }}</p>
        
        <div class="instagram-feed">
            <div class="instagram-item">
                <img src="https://images.unsplash.com/photo-1592128546260-978059b0a6d1?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                     alt="Hair Style 1">
                <a href="{{ instagram_url }}" target="_blank" class="instagram-overlay">
                    <i class="fab fa-instagram instagram-icon"></i>
                </a>
            </div>
            <div class="instagram-item">
                <img src="https://images.unsplash.com/photo-1580618672591-eb180b1a973f?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                     alt="Hair Style 2">
                <a href="{{ instagram_url }}" target="_blank" class="instagram-overlay">
                    <i class="fab fa-instagram instagram-icon"></i>
                </a>
            </div>
            <div class="instagram-item">
                <img src="https://images.unsplash.com/photo-1593351415075-3bac9f45c877?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                     alt="Hair Style 3">
                <a href="{{ instagram_url }}" target="_blank" class="instagram-overlay">
                    <i class="fab fa-instagram instagram-icon"></i>
                </a>
            </div>
            <div class="instagram-item">
                <img src="https://images.unsplash.com/photo-1591343395082-8bca2e1b6c28?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                     alt="Hair Style 4">
                <a href="{{ instagram_url }}" target="_blank" class="instagram-overlay">
                    <i class="fab fa-instagram instagram-icon"></i>
                </a>
            </div>
            <div class="instagram-item">
                <img src="https://images.unsplash.com/photo-1596703923338-48f1c07e4f2e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                     alt="Hair Style 5">
                <a href="{{ instagram_url }}" target="_blank" class="instagram-overlay">
                    <i class="fab fa-instagram instagram-icon"></i>
                </a>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <a href="{{ instagram_url }}" target="_blank" class="btn btn-instagram">
                <i class="fab fa-instagram me-2"></i> Follow @{{ instagram.replace('@', '') }}
            </a>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    // Countdown Timer
    function updateCountdown() {
        const targetDate = new Date();
        targetDate.setDate(targetDate.getDate() + 3); // Sale ends in 3 days
        
        const now = new Date().getTime();
        const distance = targetDate - now;
        
        if (distance < 0) {
            document.getElementById('countdownTimer').innerHTML = 
                '<div class="alert alert-warning text-center py-3">Sale has ended!</div>';
            return;
        }
        
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        document.getElementById('days').textContent = days.toString().padStart(2, '0');
        document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
        document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
        document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
    }

    // Initialize countdown
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // Testimonial Slider
    let currentTestimonial = 0;
    const testimonialTrack = document.getElementById('testimonialTrack');
    const testimonials = document.querySelectorAll('.testimonial-slide');
    
    function showTestimonial(index) {
        if (!testimonialTrack || testimonials.length === 0) return;
        
        currentTestimonial = index;
        const offset = -currentTestimonial * 100;
        testimonialTrack.style.transform = `translateX(${offset}%)`;
    }
    
    document.getElementById('nextTestimonial')?.addEventListener('click', function() {
        if (testimonials.length > 0) {
            currentTestimonial = (currentTestimonial + 1) % testimonials.length;
            showTestimonial(currentTestimonial);
        }
    });
    
    document.getElementById('prevTestimonial')?.addEventListener('click', function() {
        if (testimonials.length > 0) {
            currentTestimonial = (currentTestimonial - 1 + testimonials.length) % testimonials.length;
            showTestimonial(currentTestimonial);
        }
    });
    
    // Auto-rotate testimonials
    let testimonialInterval;
    if (testimonials.length > 1) {
        testimonialInterval = setInterval(() => {
            currentTestimonial = (currentTestimonial + 1) % testimonials.length;
            showTestimonial(currentTestimonial);
        }, 5000);
        
        // Pause auto-rotation on hover
        testimonialTrack?.addEventListener('mouseenter', () => {
            clearInterval(testimonialInterval);
        });
        
        testimonialTrack?.addEventListener('mouseleave', () => {
            testimonialInterval = setInterval(() => {
                currentTestimonial = (currentTestimonial + 1) % testimonials.length;
                showTestimonial(currentTestimonial);
            }, 5000);
        });
    }

    // Quick View Modal
    const quickViewModal = document.createElement('div');
    quickViewModal.className = 'modal';
    quickViewModal.id = 'quickViewModal';
    quickViewModal.innerHTML = `
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h4 class="modal-title" id="quickViewTitle"></h4>
                <button type="button" class="modal-close" onclick="closeQuickView()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="quickViewContent"></div>
        </div>
    `;
    document.body.appendChild(quickViewModal);

    document.querySelectorAll('.quick-view-btn').forEach(button => {
        button.addEventListener('click', async function() {
            const productId = this.dataset.productId;
            const productName = this.dataset.productName;
            
            document.getElementById('quickViewTitle').textContent = productName;
            
            // Show loading state
            document.getElementById('quickViewContent').innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading product details...</p>
                </div>
            `;
            
            // Show modal
            quickViewModal.classList.add('show');
            
            try {
                // Fetch product details
                const response = await fetch(`/api/products/${productId}`);
                const product = await response.json();
                
                // Render product details
                document.getElementById('quickViewContent').innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <div class="product-images">
                                <div class="thumbnails">
                                    ${product.image_urls && product.image_urls.length > 0 
                                        ? product.image_urls.map((img, index) => `
                                            <img src="${img}" alt="Product Image ${index + 1}" 
                                                 class="thumbnail ${index === 0 ? 'active' : ''}"
                                                 onclick="changeMainImage(this, '${img}')">
                                        `).join('')
                                        : `<img src="${product.image_url}" alt="Product Image" 
                                               class="thumbnail active"
                                               onclick="changeMainImage(this, '${product.image_url}')">`
                                    }
                                </div>
                                <div class="main-image-container">
                                    <img src="${product.image_url}" alt="${product.name}" 
                                         class="main-image" id="mainProductImage">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3 class="mb-3">${product.name}</h3>
                            <div class="mb-4">
                                <span class="price-amount fs-3">${product.formatted_price}</span>
                                ${product.stock > 0 
                                    ? `<span class="badge bg-success ms-2">In Stock</span>` 
                                    : `<span class="badge bg-danger ms-2">Out of Stock</span>`
                                }
                            </div>
                            
                            <div class="mb-4">
                                <h5>Description</h5>
                                <p>${product.description}</p>
                            </div>
                            
                            <div class="mb-4">
                                <h5>Details</h5>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-tag me-2 text-primary"></i> Category: ${product.category}</li>
                                    <li><i class="fas fa-box me-2 text-primary"></i> Stock: ${product.stock} units</li>
                                    <li><i class="fas fa-check-circle me-2 text-success"></i> 100% Human Hair</li>
                                </ul>
                            </div>
                            
                            <div class="d-flex gap-3">
                                <a href="/product/${product.id}" class="btn btn-outline-primary flex-fill">
                                    <i class="fas fa-info-circle me-2"></i> View Full Details
                                </a>
                                <button class="btn btn-primary flex-fill add-to-cart-btn"
                                        data-product-id="${product.id}"
                                        ${product.stock <= 0 ? 'disabled' : ''}>
                                    <i class="fas fa-cart-plus me-2"></i>
                                    ${product.stock > 0 ? 'Add to Cart' : 'Out of Stock'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Re-attach add to cart event
                attachAddToCartEvents();
                
            } catch (error) {
                document.getElementById('quickViewContent').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Failed to load product details. Please try again.
                    </div>
                `;
            }
        });
    });

    function changeMainImage(thumbnail, imageUrl) {
        // Update main image
        document.getElementById('mainProductImage').src = imageUrl;
        
        // Update active thumbnail
        document.querySelectorAll('.thumbnail').forEach(img => {
            img.classList.remove('active');
        });
        thumbnail.classList.add('active');
    }

    function closeQuickView() {
        quickViewModal.classList.remove('show');
    }

    // Close modal when clicking outside
    quickViewModal.addEventListener('click', function(event) {
        if (event.target === this) {
            closeQuickView();
        }
    });

    // Add to Cart Functionality
    function attachAddToCartEvents() {
        document.querySelectorAll('.add-to-cart-btn').forEach(button => {
            button.addEventListener('click', async function() {
                const productId = this.dataset.productId;
                const button = this;
                const originalText = button.innerHTML;
                
                // Show loading state
                button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Adding...';
                button.disabled = true;
                
                try {
                    const success = await addToCart(productId, 1);
                    
                    if (success) {
                        // Reset button after success
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.disabled = false;
                        }, 1000);
                    } else {
                        // Reset button on error
                        button.innerHTML = originalText;
                        button.disabled = false;
                    }
                    
                } catch (error) {
                    // Reset button on error
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            });
        });
    }

    // Initialize add to cart events
    attachAddToCartEvents();

    // Newsletter Subscription
    document.getElementById('newsletterForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = this.querySelector('input[type="email"]').value;
        const button = this.querySelector('button[type="submit"]');
        const originalText = button.innerHTML;
        
        // Show loading
        button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Subscribing...';
        button.disabled = true;
        
        // Simulate API call
        setTimeout(() => {
            showToast('Success!', 'You have been subscribed to our newsletter.', 'success');
            button.innerHTML = originalText;
            button.disabled = false;
            this.reset();
        }, 1500);
    });

    // Lazy load images
    document.addEventListener('DOMContentLoaded', function() {
        const lazyImages = [].slice.call(document.querySelectorAll('img.lazy'));
        
        if ('IntersectionObserver' in window) {
            let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
                entries.forEach(function(entry) {
                    if (entry.isIntersecting) {
                        let lazyImage = entry.target;
                        lazyImage.src = lazyImage.dataset.src;
                        lazyImage.classList.remove('lazy');
                        lazyImageObserver.unobserve(lazyImage);
                    }
                });
            });

            lazyImages.forEach(function(lazyImage) {
                lazyImageObserver.observe(lazyImage);
            });
        } else {
            // Fallback for older browsers
            lazyImages.forEach(function(lazyImage) {
                lazyImage.src = lazyImage.dataset.src;
                lazyImage.classList.remove('lazy');
            });
        }
    });
</script>
{% endblock %}
